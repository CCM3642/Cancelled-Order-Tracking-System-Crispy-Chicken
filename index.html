<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cancelled Orders System</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .form-group { margin-bottom: 10px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background: #f4f4f4; }
    .controls { margin: 15px 0; }
    input, select, button { padding: 6px; }
  </style>
</head>
<body>
  <h2>Cancelled Orders Management</h2>
  
  <!-- Form -->
  <div id="form">
    <div class="form-group">
      <label>Brand:</label>
      <input type="text" id="brand">
    </div>
    <div class="form-group">
      <label>Channel:</label>
      <select id="channel">
        <option>Careem</option>
        <option>Zomato</option>
        <option>Talabat</option>
      </select>
    </div>
    <div class="form-group">
      <label>Branch:</label>
      <input type="text" id="branch">
    </div>
    <div class="form-group">
      <label>Status:</label>
      <select id="status">
        <option>Cancelled</option>
        <option>Delivered</option>
      </select>
    </div>
    <div class="form-group">
      <label>Price (AED):</label>
      <input type="number" id="price" step="0.01">
    </div>
    <div class="form-group">
      <label>Orders Count:</label>
      <input type="number" id="orders">
    </div>
    <button onclick="addOrder()">Add Order</button>
  </div>

  <!-- Controls -->
  <div class="controls">
    <input type="text" id="searchInput" placeholder="Search by Channel/Branch..." onkeyup="renderTable()">
    <button onclick="exportToCSV()">Export CSV</button>
    <button onclick="exportToPDF()">Export PDF</button>
  </div>

  <!-- Table -->
  <table id="ordersTable">
    <thead>
      <tr>
        <th>Brand</th>
        <th>Channel</th>
        <th>Branch</th>
        <th>Status</th>
        <th>Price</th>
        <th>Orders</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h3>Dashboard Report</h3>
  <div id="dashboard"></div>

  <!-- PDF Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <script>
    let orders = JSON.parse(localStorage.getItem('orders')) || [];

    function addOrder() {
      const brand = document.getElementById('brand').value.trim();
      const channel = document.getElementById('channel').value;
      const branch = document.getElementById('branch').value.trim();
      const status = document.getElementById('status').value;
      const price = parseFloat(document.getElementById('price').value) || 0;
      const orderCount = parseInt(document.getElementById('orders').value) || 0;

      if (!brand || !branch || price <= 0 || orderCount <= 0) {
        alert("Please fill all fields correctly!");
        return;
      }

      orders.push({ brand, channel, branch, status, price, orderCount });
      localStorage.setItem('orders', JSON.stringify(orders));

      renderTable();
      renderDashboard();
    }

    function renderTable() {
      const tbody = document.querySelector("#ordersTable tbody");
      tbody.innerHTML = "";
      const search = document.getElementById("searchInput").value.toLowerCase();

      orders.filter(o => 
        o.channel.toLowerCase().includes(search) || 
        o.branch.toLowerCase().includes(search)
      ).forEach(o => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${o.brand}</td>
          <td>${o.channel}</td>
          <td>${o.branch}</td>
          <td>${o.status}</td>
          <td>${o.price.toFixed(2)}</td>
          <td>${o.orderCount}</td>`;
        tbody.appendChild(tr);
      });
    }

    function renderDashboard() {
      let cancelled = orders.filter(o => o.status === "Cancelled");
      let delivered = orders.filter(o => o.status === "Delivered");
      let cancelledTotal = cancelled.reduce((sum, o) => sum + (o.price * o.orderCount), 0);
      let deliveredTotal = delivered.reduce((sum, o) => sum + (o.price * o.orderCount), 0);

      document.getElementById("dashboard").innerHTML = `
        <p><b>Total Cancelled Orders:</b> ${cancelled.length} (AED ${cancelledTotal.toFixed(2)})</p>
        <p><b>Total Delivered Orders:</b> ${delivered.length} (AED ${deliveredTotal.toFixed(2)})</p>
      `;
    }

    function exportToCSV() {
      let csv = "Brand,Channel,Branch,Status,Price,Orders\n";
      orders.forEach(o => {
        csv += `${o.brand},${o.channel},${o.branch},${o.status},${o.price},${o.orderCount}\n`;
      });
      let blob = new Blob([csv], { type: 'text/csv' });
      let a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "orders.csv";
      a.click();
    }

    function exportToPDF() {
      const element = document.getElementById("ordersTable");
      html2pdf().from(element).save("orders.pdf");
    }

    // Initial render
    renderTable();
    renderDashboard();
  </script>
</body>
</html>
